version: 1
name: metrics_ci_smoke_nonfred
created: "2026-02-11"
description: >
  CI smoke spec that includes a non-FRED source and a daily market series to
  exercise ingest -> compute -> validate beyond FRED-only paths.

sources:
  fred:
    kind: fred
    api_base_url: "https://api.stlouisfed.org/fred"
    api_key_env: FRED_API_KEY
    api_default_file_type: json
    graph_csv_url_template: "https://fred.stlouisfed.org/graph/fredgraph.csv?id={series_id}"
  stooq:
    kind: csv
    url_template: "https://stooq.com/q/d/l/?s={symbol}&i=d"

series:
  unrate_unemployment_rate:
    source: fred
    series_id: UNRATE
    frequency: M
    units: "percent"
    description: "Civilian Unemployment Rate (BLS CPS, SA)."
  sp500_sp500_index:
    source: stooq
    symbol: "^spx"
    frequency: D
    units: "index"
    column: Close
    description: "S&P 500 index level (close; price index, excludes dividends)."
    filters:
      start_date: "1957-01-02"

metrics:
  - id: unemployment_rate_mean
    family: unemployment
    label: "Unemployment rate (mean during term)"
    inputs:
      series: unrate_unemployment_rate
    period_transform:
      kind: identity
    term_aggregation:
      kind: mean
      units: "percent"

  - id: unemployment_rate_change_pp
    family: unemployment
    label: "Unemployment rate change (percentage points, end minus start)"
    inputs:
      series: unrate_unemployment_rate
    period_transform:
      kind: identity
    term_aggregation:
      kind: end_minus_start
      units: "percentage points"

  - id: unemployment_rate_change_pp_per_year
    family: unemployment
    label: "Unemployment rate change (percentage points per year, end minus start divided by term years)"
    inputs:
      series: unrate_unemployment_rate
    period_transform:
      kind: identity
    term_aggregation:
      kind: end_minus_start_per_year
      units: "percentage points per year"

  - id: sp500_term_pct_change
    family: stock_levels
    label: "S&P 500 percent change (term total, end vs start)"
    inputs:
      series: sp500_sp500_index
    period_transform:
      kind: identity
    term_aggregation:
      kind: pct_change_from_levels
      scale: 100
      units: "percent"

  - id: sp500_term_cagr_pct
    family: stock_levels
    label: "S&P 500 CAGR (term annualized from start/end)"
    inputs:
      series: sp500_sp500_index
    period_transform:
      kind: identity
    term_aggregation:
      kind: cagr_from_levels
      scale: 100
      use_actual_time: true
      units: "percent"
